<div id="copied-content" style="display:none;">
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M11.35 3.836c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m8.9-4.414c.376.023.75.05 1.124.08 1.131.094 1.976 1.057 1.976 2.192V16.5A2.25 2.25 0 0 1 18 18.75h-2.25m-7.5-10.5H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V18.75m-7.5-10.5h6.375c.621 0 1.125.504 1.125 1.125v9.375m-8.25-3 1.5 1.5 3-3.75" />
  </svg>
  <span>Copied</span>
</div>

<script>
  function copyToClipboard() {
    const content = document.getElementById('text-content').innerText;
    const button = document.getElementById('copy-btn');

    // Save original button text
    const originalText = button.innerHTML;
    const copiedHtml = document.getElementById('copied-content').innerHTML;

    navigator.clipboard.writeText(content).then(() => {
      // Update button to show "Copied" with a checkmark
      button.innerHTML = copiedHtml;

      // Revert back to original text after 2 seconds
      setTimeout(() => {
        button.innerHTML = originalText;
      }, 2000);
    }).catch(err => {
      // Handle error case
      button.innerHTML = "‚ùå <span>Error</span>";
      setTimeout(() => {
        button.innerHTML = originalText;
      }, 2000);
    });
  }

  function downloadForDSAR() {
    const content = document.getElementById('text-content').innerText;
    const email = document.getElementById('download-btn').dataset.email || 'unknown';
    const date = new Date().toISOString().split('T')[0];

    const html = `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Your data in Mozilla Basket</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 900px; margin: 40px auto; padding: 20px; line-height: 1.6; }
    h2 { color: #555; margin-top: 30px; }
    .intro { background: #f0f7ff; padding: 15px 20px; border-left: 4px solid #0060df; margin: 20px 0; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    th, td { text-align: left; padding: 8px 12px; border: 1px solid #ddd; }
    th { background: #f5f5f5; width: 30%; }
    details { margin-bottom: 10px; }
    summary { cursor: pointer; font-weight: 600; padding: 10px; background: #f5f5f5; }
    details table { margin-top: 0; }
    pre { background: #f5f5f5; padding: 20px; overflow-x: auto; }
  </style>
</head>
<body>
  <div class="intro">
    <p>This file contains information that we collected linked to your account in <strong>Basket</strong> - Mozilla's Newsletter Service. Below is the granular description of collected fields.</p>
  </div>

  <h2>Field Descriptions</h2>

  <details open>
    <summary>amo - Addon Authors Data</summary>
    <table>
      <tr><th>Field</th><th>Description</th></tr>
      <tr><td>add_on_ids</td><td>IDs of addons for which the user is listed as an author</td></tr>
      <tr><td>create_timestamp</td><td>Date/Time the record was created</td></tr>
      <tr><td>display_name</td><td>User's name</td></tr>
      <tr><td>email_opt_in</td><td>User has opted into email or not</td></tr>
      <tr><td>language</td><td>User's preferred language</td></tr>
      <tr><td>last_login</td><td>Date/Time of user's last login</td></tr>
      <tr><td>location</td><td>Country from which the user signed up to AMO</td></tr>
      <tr><td>profile_url</td><td>URL on AMO for the user</td></tr>
      <tr><td>update_timestamp</td><td>Date/Time the user's record was last updated</td></tr>
      <tr><td>user</td><td>Whether the user is an AMO user (true or false)</td></tr>
      <tr><td>user_id</td><td>AMO internal user ID</td></tr>
      <tr><td>username</td><td>AMO username</td></tr>
    </table>
  </details>

  <details open>
    <summary>email - Marketing Email Data</summary>
    <table>
      <tr><th>Field</th><th>Description</th></tr>
      <tr><td>basket_token</td><td>User ID used to identify the user in unsubscribe links in emails</td></tr>
      <tr><td>create_timestamp</td><td>Date/Time the user record was created</td></tr>
      <tr><td>double_opt_in</td><td>Whether the user has opted into receiving email (true/false)</td></tr>
      <tr><td>email_format</td><td>H or T for HTML or Text</td></tr>
      <tr><td>email_id</td><td>Internal ID for the user</td></tr>
      <tr><td>email_lang</td><td>Language in which the user would prefer to receive emails</td></tr>
      <tr><td>first_name</td><td>First name</td></tr>
      <tr><td>has_opted_out_of_email</td><td>Whether the user has opted out of all email (true/false)</td></tr>
      <tr><td>last_name</td><td>Last name</td></tr>
      <tr><td>mailing_country</td><td>Country of residence of the user</td></tr>
      <tr><td>primary_email</td><td>User's email address for marketing purposes</td></tr>
      <tr><td>sfdc_id</td><td>Legacy ID from the no-longer-used SFDC system</td></tr>
      <tr><td>unsubscribe_reason</td><td>Optional text for why the user opted out of email</td></tr>
      <tr><td>update_timestamp</td><td>Date/Time the user's record was last updated</td></tr>
    </table>
  </details>

  <details open>
    <summary>fxa - Mozilla Accounts Data</summary>
    <table>
      <tr><th>Field</th><th>Description</th></tr>
      <tr><td>account_deleted</td><td>Whether the user's Mozilla Account has been deleted (true/false)</td></tr>
      <tr><td>created_date</td><td>Date/Time on which the user's FxA was created</td></tr>
      <tr><td>first_service</td><td>First service the user signed up for with their FxA (e.g. Sync or VPN)</td></tr>
      <tr><td>fxa_id</td><td>ID of the user in FxA</td></tr>
      <tr><td>lang</td><td>Language the user prefers to use in FxA</td></tr>
      <tr><td>primary_email</td><td>Primary email of the user in FxA (if different from primary_email in the email section)</td></tr>
    </table>
  </details>

  <details open>
    <summary>mofo - Mozilla Foundation Data</summary>
    <table>
      <tr><th>Field</th><th>Description</th></tr>
      <tr><td>mofo_contact_id</td><td>Internal ID for the user at MoFo</td></tr>
      <tr><td>mofo_email_id</td><td>Internal ID for the user's email at MoFo</td></tr>
      <tr><td>mofo_relevant</td><td>Whether the user has interacted with MoFo (true/false)</td></tr>
    </table>
  </details>

  <details open>
    <summary>newsletters - Newsletter Subscriptions</summary>
    <table>
      <tr><th>Field</th><th>Description</th></tr>
      <tr><td>create_timestamp</td><td>Date/Time the user subscribed to the newsletter</td></tr>
      <tr><td>format</td><td>H or T for HTML or Text</td></tr>
      <tr><td>lang</td><td>Language the user selected when subscribing to this newsletter</td></tr>
      <tr><td>name</td><td>Identifier of the newsletter for this subscription. See <a href="https://basket.mozilla.org/news/">https://basket.mozilla.org/news/</a></td></tr>
      <tr><td>source</td><td>URL of the form used to subscribe to this newsletter</td></tr>
      <tr><td>subscribed</td><td>Whether the user is still subscribed to this newsletter (true/false)</td></tr>
      <tr><td>unsub_reason</td><td>Optional text for why the user unsubscribed</td></tr>
      <tr><td>update_timestamp</td><td>Date/Time the user's record was last updated</td></tr>
    </table>
  </details>

  <details open>
    <summary>waitlists - Product Waiting Lists</summary>
    <table>
      <tr><th>Field</th><th>Description</th></tr>
      <tr><td colspan="2"><em>Including "relay_waitlist" and "vpn_waitlist": Very similar to newsletters but for product waiting lists</em></td></tr>
    </table>
  </details>

  <hr>
  <h2>Raw Data</h2>
  <pre>${content}</pre>
</body>
</html>`;

    const blob = new Blob([html], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    const safeEmail = email.replace(/[@.]/g, '_');
    a.download = `data-basket-${safeEmail}-${date}.html`;
    a.click();
    URL.revokeObjectURL(url);
  }
</script>
